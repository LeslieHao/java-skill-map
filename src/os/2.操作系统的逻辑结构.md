### 1.操作系统的逻辑结构
#### 逻辑结构：OS的设计和实现思路
#### 逻辑结构的种类

* 整体式结构
![](https://tva1.sinaimg.cn/large/007S8ZIlly1ggpd4d2uw6j30wu0u0wi4.jpg)
* 层次式结构（类比TCP/IP 协议栈）
![](https://tva1.sinaimg.cn/large/007S8ZIlly1ggpd4nem2pj31by0nmq6b.jpg)
* 微内核结构（client/server 结构）
微内核+核外服务器，微内核足够小，提供OS最基本的核心功能和服务，核外服务器提供OS绝大部分服务功能，等待应用程序提出请求

### 2.CPU的态(SHD)
##### 支持操作系统最基本的硬件结构
* CPU
* 内存
* 中断
* 时钟

##### CPU 态（MODE）

* CPU 的工作状态
* 对资源和指令 使用权限的描述
##### 态的分类

1. 核态(kernel mode)：能够访问所有资源和执行所有指令，管理程序/OS内核 都工作在核态
2. 用户态(user mode,目态)：仅能访问部分资源，其他资源授信（如特权指令等），用户程序工作在用户态
##### 用户态和核态之间的转换

* **用户态->核态**：
    * 用户请求OS 提供服务
    * 发生中断(中断响应的过程是发生在核态)
    * 用户进程产生错误（内部中断）
    * 用户态企图执行特权指令
* **核态->用户态**：
    * 一般是执行中断返回：IRET

##### 硬件和OS对CPU的观察

* 硬件按”态“来区分CPU的状态
* OS按”进程“来区分CPU的状态（CPU上正在运行的是哪一个进程）
##### 存储器

* 按存储器的读写方式
    * RAM
    * ROM
* 按存储元的材料
    * 半导体（常做主存）
    * 磁存储器（磁盘、磁带）
    * 光存储器（光盘）
* 按与CPU的联系
    * 主存（内存）：直接和CPU交换信息
    * 辅存（外存）：不能直接和CPU交换信息
##### 分级存储系统工作原理
* 访问缓存（命中 hit）
* 访问内存（没有命中 miss）
* 访问辅存（缺页 page fault）

![](https://tva1.sinaimg.cn/large/007S8ZIlly1ggpd50xcq8j30t6098t9k.jpg)
![](https://tva1.sinaimg.cn/large/007S8ZIlly1ggpd57rkhij31os0u0gqb.jpg)

### 3.中断机制
#### 中断定义

* CPU对外部突发的事件的反应过程或机制
* CPU 收到外部信号（中断信号），停止当前工作，转去处理该外部事件，处理完毕后回到中断处（断点）继续原来的工作
![](https://tva1.sinaimg.cn/large/007S8ZIlly1ggpd5gms1rj30ki0ecjsg.jpg)
##### 引入中断的目的

* 实现并发活动
* 实现实时处理
* 故障自动处理

**断点**：程序中断的地方，将要执行的下一指令的地址

**现场（上下文）**：程序正确运行所依赖的信息集合，（CPU内部的相关寄存器）

**现场的两个处理过程**：

1. 现场的保护：进入中断服务程序之前，将现场数据存入栈中
2. 现场的还原：中断服务程序退出之后，还原现场（出栈）
##### 中断响应过程
识别中断源->保护断点和现场->装入中断服务程序的入口地址（CS:IP）->进入中断服务程序->恢复断点和现场->中断返回：IRET
##### 中断响应的实质

* 交换指令的执行地址
* 交换CPU的态
* 现场保护和恢复
* 参数传递（中断服务程序返回参数到主程序）

